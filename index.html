<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Opulent Hardware - Calendar</title>
  <link href="https://fonts.googleapis.com/css2?family=Saira:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      /* DARK THEME — tuned for true black while preserving legibility */
      --d-bg: #000000;               /* real black */
      --d-bg-2: #0a0a0a;             /* near-black for subtle panel separation */
      --d-border: rgba(255,255,255,.10); /* slightly stronger to read on black */
      --d-text: #f2f6ff;             /* soft white for comfortable contrast */
      --d-muted: #9aa6b2;            /* cool gray-blue, readable on black */
      --d-accent: #b6ff3b;           /* existing accent pops well on black */

      /* LIGHT THEME (unchanged) */
      --l-bg: #f5f7fb;
      --l-bg-2: #eef2f7;
      --l-border: rgba(0,0,0,.08);
      --l-text: #1b2733;
      --l-muted: #5a6a7a;
      --l-accent: #4aa9ff;

      --radius: 20px;
      --shadow: 0 24px 60px rgba(0,0,0,.35), 0 8px 20px rgba(0,0,0,.35);
      --tile: 14px;
    }

    html[data-theme="dark"] {
      --bg: var(--d-bg);
      --bg2: var(--d-bg-2);
      --border: var(--d-border);
      --text: var(--d-text);
      --muted: var(--d-muted);
      --accent: var(--d-accent);
    }
    html[data-theme="light"] {
      --bg: var(--l-bg);
      --bg2: var(--l-bg-2);
      --border: var(--l-border);
      --text: var(--l-text);
      --muted: var(--l-muted);
      --accent: var(--l-accent);
    }

    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Saira', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Inter", "SF Pro", Arial, sans-serif;
      /* Vignette kept *very* subtle so true black reads as black */
      background:
        radial-gradient(1200px 700px at 60% -10%, rgba(255,255,255,.02) 0, transparent 55%),
        var(--bg);
      color: var(--text);
      display: grid; place-items: center;
    }

    .frame {
      width: min(1100px, 96vw);
      height: min(820px, 92vh);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      display: grid;
      grid-template-rows: auto 1fr;
      background: var(--bg);
      border: 1px solid var(--border);
    }

    /* Top wood branding */
    .top-wood {
      position: relative;
      background:
        linear-gradient(90deg, rgba(0,0,0,.06), rgba(0,0,0,0) 18%),
        repeating-linear-gradient(12deg,
          rgba(80,40,20,.35) 0 6px,
          rgba(120,70,40,.35) 6px 14px,
          rgba(60,30,15,.35) 14px 22px
        ),
        linear-gradient(180deg, #8c5d3d, #c08a5a 50%, #9a6946 100%);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.25), inset 0 -1px 0 rgba(0,0,0,.25);
      padding: 8px 12px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
    }
    .engrave {
      font-weight: 400; letter-spacing: .18em; font-size: clamp(9px, 1.3vmin, 13px);
      color: rgba(0,0,0,.7);
      text-shadow: 0 1px 0 rgba(255,255,255,.25), 0 -1px 0 rgba(0,0,0,.8);
      text-transform: uppercase; text-align: left;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }

    .panel { display: grid; grid-template-rows: auto 1fr; height: 100%; width: 100%; background: linear-gradient(180deg, var(--bg2), var(--bg)); }

    .bar {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0));
    }

    .left-actions { justify-self: start; display: flex; gap: 8px; align-items: center; }
    .right-actions { justify-self: end; display: flex; gap: 8px; align-items: center; }

    .month-nav { justify-self: center; display: inline-flex; gap: 10px; align-items: center; }
    .month-title { font-weight: 800; letter-spacing: 0.06em; }

    .btn, .toggle {
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      color: var(--text);
      border-radius: 999px;
      padding: 8px 12px;
      cursor: pointer;
      font-weight: 600;
    }

    .btn.icon { width: 36px; height: 32px; display:grid; place-items:center; padding:0; }

    /* compact segmented S / M control */
    .seg-control {
      display: inline-flex;
      gap: 4px;
      align-items: center;
      padding: 3px;
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0));
      border-radius: 999px;
      border: 1px solid var(--border);
    }
    .seg {
      min-width: 34px;
      height: 34px;
      display: inline-grid;
      place-items: center;
      border-radius: 999px;
      padding: 0 10px;
      cursor: pointer;
      font-weight: 700;
      font-size: .9rem;
      color: var(--muted);
      border: 1px solid transparent;
      background: transparent;
    }
    .seg[aria-pressed="true"] {
      color: var(--bg);
      background: linear-gradient(180deg, var(--accent), color-mix(in oklab, var(--accent) 80%, black 20%));
      border-color: rgba(0,0,0,.12);
      box-shadow: 0 6px 16px rgba(0,0,0,.35);
    }

    .grid { display: grid; grid-template-rows: auto 1fr; height: 100%; min-height: 0; }
    .dow { display: grid; grid-template-columns: repeat(7, 1fr); text-align:center; padding: 6px 10px; color: var(--muted); }

    .days {
      --rows: 6;
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-template-rows: repeat(var(--rows), 1fr);
      height: 100%;
      min-height: 0;
      gap: var(--tile);
      padding: 10px;
      box-sizing: border-box;
    }

    .day {
      position: relative; border-radius: 16px;
      border: 1px solid var(--border);
      /* On true black, lift the tiles slightly with a faint top highlight */
      background:
        linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.015));
      transition: transform .12s ease, box-shadow .12s ease, outline-color .12s ease;
      min-height: 0;
    }

    .day:hover { transform: translateY(-2px); box-shadow: 0 8px 18px rgba(0,0,0,.35); }
    .num { position: absolute; top: 8px; right: 10px; font-size: .9rem; color: var(--muted); }

    /* Today ring — color-mix with fallback for older browsers */
    .today {
      outline: 2px solid color-mix(in oklab, var(--accent) 60%, transparent);
      box-shadow: 0 0 0 3px color-mix(in oklab, var(--accent) 25%, transparent);
    }
    @supports not (color-mix(in oklab, white 50%, black)) {
      .today {
        outline: 2px solid var(--accent);
        box-shadow: 0 0 0 3px rgba(182,255,59,.25);
      }
    }

    /* Focus for keyboard users */
    .day:focus {
      outline: 2px solid rgba(255,255,255,.35);
      outline-offset: -2px;
      box-shadow: 0 0 0 3px rgba(255,255,255,.12);
    }

    @media (prefers-reduced-motion: reduce){ .day { transition: none; } }
    @media (max-width: 560px){ .dow { display: none; } .num { font-size: 0.85rem; } }
  </style>
</head>
<body>
  <div class="frame">
    <div class="top-wood">
      <div class="engrave">OPULENT&nbsp;HARDWARE</div>
    </div>

    <section class="panel">
      <header class="bar">
        <div class="left-actions">
          <!-- Segmented control: S = Sunday (0), M = Monday (1) -->
          <div class="seg-control" role="radiogroup" aria-label="Week start">
            <button class="seg" id="seg-s" data-value="0" aria-pressed="true" title="Start week on Sunday">S</button>
            <button class="seg" id="seg-m" data-value="1" aria-pressed="false" title="Start week on Monday">M</button>
          </div>
        </div>

        <div class="month-nav">
          <button class="btn icon" id="prev" aria-label="Previous month">◀</button>
          <div class="month-title" id="title">—</div>
          <button class="btn icon" id="next" aria-label="Next month">▶</button>
        </div>

        <div class="right-actions">
          <button class="toggle" id="mode" aria-label="Toggle theme">Toggle</button>
        </div>
      </header>

      <div class="grid">
        <div class="dow" id="dow"></div>
        <div class="days" id="days" role="grid" aria-label="Calendar month grid"></div>
      </div>
    </section>
  </div>

  <script>
    const params = new URLSearchParams(location.search);
    const themeParam = params.get('theme');
    // weekStart is now mutable (let) so the segmented control can update it.
    let weekStart = Number(params.get('weekStart') ?? 0);
    const initial = params.get('initial');

    // ensure the value is 0 (Sunday) or 1 (Monday); default to 0
    if (weekStart !== 0 && weekStart !== 1) weekStart = 0;

    if (themeParam === 'light' || themeParam === 'dark') {
      document.documentElement.setAttribute('data-theme', themeParam);
    }

    const title = document.getElementById('title');
    const daysWrap = document.getElementById('days');
    const dowWrap = document.getElementById('dow');

    const segS = document.getElementById('seg-s');
    const segM = document.getElementById('seg-m');

    const WEEKDAYS = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

    function buildDOW() {
      const order = [...WEEKDAYS.slice(weekStart), ...WEEKDAYS.slice(0, weekStart)];
      dowWrap.innerHTML = order.map(d => `<div>${d}</div>`).join('');
    }

    let current = (() => {
      if (!initial) return new Date();
      const [y, m] = initial.split('-').map(Number);
      return new Date(y, (m || 1) - 1, 1);
    })();

    const state = { events: {} };

    function formatMonth(date) {
      return date.toLocaleDateString(undefined, { month: 'long', year: 'numeric' }).toUpperCase();
    }
    function startOfMonth(date) { return new Date(date.getFullYear(), date.getMonth(), 1); }
    function endOfMonth(date) { return new Date(date.getFullYear(), date.getMonth() + 1, 0); }

    function toLocalKey(date){
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, '0');
      const d = String(date.getDate()).padStart(2, '0');
      return `${y}-${m}-${d}`;
    }

    function render() {
      buildDOW();
      const start = startOfMonth(current);
      const end = endOfMonth(current);
      title.textContent = formatMonth(current);
      const startIdx = (start.getDay() - weekStart + 7) % 7;
      const daysInMonth = end.getDate();
      const today = new Date();

      const cells = startIdx + daysInMonth;
      const rows = Math.ceil(cells / 7);
      daysWrap.style.setProperty('--rows', rows);

      const frag = document.createDocumentFragment();

      // leading blanks
      for (let i = 0; i < startIdx; i++) {
        const blank = document.createElement('div');
        blank.setAttribute('aria-hidden', 'true');
        frag.appendChild(blank);
      }

      for (let d = 1; d <= daysInMonth; d++) {
        const date = new Date(current.getFullYear(), current.getMonth(), d);
        const isToday = date.toDateString() === today.toDateString();
        const key = toLocalKey(date);
        const evs = state.events[key] || [];

        const cell = document.createElement('div');
        cell.className = `day ${isToday ? 'today' : ''}`;
        cell.dataset.date = key;
        cell.setAttribute('role', 'gridcell');
        cell.setAttribute('tabindex', '0');
        cell.setAttribute('aria-label', date.toLocaleDateString(undefined, {weekday:'long', year:'numeric', month:'long', day:'numeric'}));

        const num = document.createElement('div');
        num.className = 'num';
        num.textContent = d;
        cell.appendChild(num);

        if (evs.length) {
          const dots = document.createElement('div');
          dots.style.position = 'absolute';
          dots.style.left = '8px';
          dots.style.bottom = '6px';
          evs.slice(0, 3).forEach(() => {
            const dot = document.createElement('span');
            dot.style.display = 'inline-block';
            dot.style.width = dot.style.height = '6px';
            dot.style.marginRight = '4px';
            dot.style.borderRadius = '50%';
            dot.style.background = 'var(--accent)';
            dots.appendChild(dot);
          });
          if (evs.length > 3) {
            const more = document.createElement('span');
            more.textContent = `+${evs.length - 3}`;
            more.style.fontSize = '10px';
            more.style.color = 'var(--muted)';
            dots.appendChild(more);
          }
          cell.appendChild(dots);
        }

        frag.appendChild(cell);
      }

      daysWrap.innerHTML = '';
      daysWrap.appendChild(frag);

      // update segmented control visual state
      updateSegControl();
    }

    function updateSegControl() {
      // set aria-pressed and styles
      if (weekStart === 0) {
        segS.setAttribute('aria-pressed', 'true');
        segM.setAttribute('aria-pressed', 'false');
      } else {
        segS.setAttribute('aria-pressed', 'false');
        segM.setAttribute('aria-pressed', 'true');
      }
    }

    function setWeekStart(val) {
      // val expected 0 or 1
      if (val !== 0 && val !== 1) return;
      weekStart = val;
      // update URL param without reloading
      const url = new URL(location);
      url.searchParams.set('weekStart', String(weekStart));
      history.replaceState({}, '', url);
      render();
    }

    segS.addEventListener('click', () => setWeekStart(0));
    segM.addEventListener('click', () => setWeekStart(1));
    segS.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); setWeekStart(0); }});
    segM.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); setWeekStart(1); }});

    document.getElementById('prev').onclick = () => {
      current = new Date(current.getFullYear(), current.getMonth() - 1, 1);
      render();
    };
    document.getElementById('next').onclick = () => {
      current = new Date(current.getFullYear(), current.getMonth() + 1, 1);
      render();
    };
    document.getElementById('mode').onclick = () => {
      const next = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
    };

    // initial render (seg control state will be correct after render)
    render();
  </script>
</body>
</html>
